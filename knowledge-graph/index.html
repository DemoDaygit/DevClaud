<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Graph v3.0 - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ–µ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ò–ò</title>
    
    <!-- D3.js –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Three.js –¥–ª—è 3D –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- GSAP –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <!-- Vis.js –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –≥—Ä–∞—Ñ–æ–≤ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" type="text/css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
        }
        
        #app {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: 80px 1fr;
            height: 100vh;
            gap: 0;
        }
        
        /* Header */
        .header {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, rgba(79, 39, 245, 0.8), rgba(11, 165, 233, 0.8));
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(100, 200, 255, 0.3);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(79, 39, 245, 0.2);
        }
        
        .header h1 {
            font-size: 1.6em;
            font-weight: 700;
            background: linear-gradient(90deg, #64d8ff, #a0ff6f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .control-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #64d8ff;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(100, 216, 255, 0.5);
            box-shadow: 0 0 10px rgba(100, 216, 255, 0.3);
        }
        
        /* Left Sidebar - Controls */
        .sidebar-left {
            background: rgba(20, 20, 40, 0.9);
            border-right: 2px solid rgba(100, 200, 255, 0.2);
            padding: 20px;
            overflow-y: auto;
            z-index: 50;
        }
        
        .sidebar-section {
            margin-bottom: 25px;
        }
        
        .sidebar-title {
            font-size: 0.95em;
            font-weight: 600;
            color: #64d8ff;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid rgba(100, 216, 255, 0.3);
            padding-bottom: 8px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .filter-item:hover {
            background: rgba(100, 216, 255, 0.1);
        }
        
        .filter-item input[type="checkbox"] {
            cursor: pointer;
            accent-color: #64d8ff;
        }
        
        .filter-item label {
            cursor: pointer;
            flex: 1;
            font-size: 0.9em;
        }
        
        /* Main Visualization Area */
        .main-content {
            grid-column: 2;
            grid-row: 2;
            position: relative;
            background: radial-gradient(circle at 20% 50%, rgba(79, 39, 245, 0.1), transparent),
                        radial-gradient(circle at 80% 80%, rgba(11, 165, 233, 0.1), transparent);
        }
        
        #network {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        #canvas3d {
            position: absolute;
            top: 0;
            left: 0;
        }
        
        /* Right Sidebar - Info Panel */
        .sidebar-right {
            background: rgba(20, 20, 40, 0.9);
            border-left: 2px solid rgba(100, 200, 255, 0.2);
            padding: 20px;
            overflow-y: auto;
            z-index: 50;
        }
        
        .info-panel {
            display: none;
        }
        
        .info-panel.active {
            display: block;
        }
        
        .info-header {
            font-size: 1.3em;
            font-weight: 700;
            color: #a0ff6f;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(160, 255, 111, 0.3);
        }
        
        .info-item {
            margin-bottom: 15px;
        }
        
        .info-label {
            font-size: 0.85em;
            color: #64d8ff;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 0.95em;
            color: #e0e0e0;
            line-height: 1.5;
        }
        
        .formula-box {
            background: rgba(100, 216, 255, 0.1);
            border-left: 3px solid #64d8ff;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #a0ff6f;
            margin-top: 5px;
            overflow-x: auto;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .tag {
            background: rgba(160, 255, 111, 0.15);
            border: 1px solid rgba(160, 255, 111, 0.3);
            color: #a0ff6f;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(100, 216, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(100, 216, 255, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 216, 255, 0.5);
        }
        
        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(100, 216, 255, 0.3); }
            50% { box-shadow: 0 0 20px rgba(100, 216, 255, 0.6); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        .glow {
            animation: glow 2s infinite;
        }
        
        /* Legend */
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(20, 20, 40, 0.95);
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            max-width: 250px;
            z-index: 40;
            font-size: 0.85em;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            #app {
                grid-template-columns: 250px 1fr 300px;
            }
            
            .sidebar-left, .sidebar-right {
                font-size: 0.9em;
            }
        }
        
        @media (max-width: 768px) {
            #app {
                grid-template-columns: 1fr;
            }
            
            .sidebar-left, .sidebar-right {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>üß† Knowledge Graph v3.0 - –†–æ–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –ò–ò</h1>
            <div class="header-controls">
                <button class="control-btn" onclick="toggleLayout()">üìê –ú–∞–∫–µ—Ç</button>
                <button class="control-btn" onclick="togglePhysics()">‚öôÔ∏è –§–∏–∑–∏–∫–∞</button>
                <button class="control-btn" onclick="exportGraph()">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="control-btn" onclick="resetView()">üîÑ –°–±—Ä–æ—Å</button>
            </div>
        </div>
        
        <div class="sidebar-left">
            <div class="sidebar-section">
                <div class="sidebar-title">üéØ –§–∏–ª—å—Ç—Ä—ã</div>
                <div class="filter-group" id="categoryFilters"></div>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">üìä –¢–∏–ø —Å–≤—è–∑–∏</div>
                <div class="filter-group" id="edgeFilters"></div>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">üìÖ –ü–µ—Ä–∏–æ–¥</div>
                <input type="range" id="yearSlider" min="2018" max="2025" value="2025" 
                       style="width: 100%; cursor: pointer;">
                <div style="text-align: center; margin-top: 8px; color: #64d8ff;">
                    <span id="yearDisplay">2025</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">üîç –ü–æ–∏—Å–∫</div>
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —É–∑–ª–æ–≤..."
                       style="width: 100%; padding: 8px; background: rgba(100, 216, 255, 0.1); 
                              border: 1px solid rgba(100, 216, 255, 0.3); border-radius: 4px;
                              color: #e0e0e0;">
            </div>
            
            <div class="sidebar-section">
                <button class="control-btn" style="width: 100%; margin-bottom: 8px;" onclick="saveState()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="control-btn" style="width: 100%;" onclick="loadState()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
        
        <div class="main-content">
            <div id="network"></div>
            <canvas id="canvas3d"></canvas>
            
            <div class="legend">
                <div style="color: #64d8ff; font-weight: 600; margin-bottom: 10px;">–õ–µ–≥–µ–Ω–¥–∞</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #64d8ff;"></div>
                    <span>–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #a0ff6f;"></div>
                    <span>–ú–µ—Ç–æ–¥/–¢–µ—Ö–Ω–∏–∫–∞</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff6b9d;"></div>
                    <span>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffd93d;"></div>
                    <span>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</span>
                </div>
            </div>
        </div>
        
        <div class="sidebar-right">
            <div class="info-panel" id="infoPanel">
                <div class="info-header" id="infoTitle">–í—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª</div>
                
                <div class="info-item">
                    <div class="info-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
                    <div class="info-value" id="infoCategory">‚Äî</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">–ì–æ–¥ –≤–≤–µ–¥–µ–Ω–∏—è</div>
                    <div class="info-value" id="infoYear">‚Äî</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                    <div class="info-value" id="infoDescription">‚Äî</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">–§–æ—Ä–º—É–ª–∞</div>
                    <div class="formula-box" id="infoFormula" style="display: none;">‚Äî</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">–¢–†–ò–ó-–ø—Ä–∏–Ω—Ü–∏–ø</div>
                    <div class="info-value" id="infoTRIZ">‚Äî</div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">–°–≤—è–∑–∞–Ω–Ω—ã–µ —É–∑–ª—ã</div>
                    <div class="tags" id="infoRelated"></div>
                </div>
                
                <div class="info-item">
                    <div class="info-label">–°—Å—ã–ª–∫–∏</div>
                    <div class="tags" id="infoLinks"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ============ –î–ê–ù–ù–´–ï –ì–†–ê–§–ê ============
        const GRAPH_DATA = {
            nodes: [
                // –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
                { id: 1, label: 'Swarm Intelligence', group: 'foundation', year: 1989, 
                  description: '–ö–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤',
                  formula: 'SI = ‚àë(Agent_i behavior + Social interaction)',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 1: –î—Ä–æ–±–ª–µ–Ω–∏–µ' },
                
                { id: 2, label: 'Multi-Agent Systems', group: 'foundation', year: 1995,
                  description: '–°–∏—Å—Ç–µ–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤',
                  formula: 'MAS = {A_1, A_2, ..., A_n} with interaction protocol',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 4: –ê—Å–∏–º–º–µ—Ç—Ä–∏—è' },
                
                { id: 3, label: 'Emergence', group: 'foundation', year: 1992,
                  description: '–í–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏–∑ –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∞–≤–∏–ª',
                  formula: 'Emergence: Local rules ‚Üí Global patterns',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 5: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ' },
                
                { id: 4, label: 'Federated Learning', group: 'method', year: 2016,
                  description: '–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
                  formula: 'FL: w_t+1 = w_t - Œ∑‚àáF(w_t)',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 2: –í—ã–Ω–µ—Å–µ–Ω–∏–µ' },
                
                { id: 5, label: 'Gradient Compression', group: 'technique', year: 2017,
                  description: '–°–∂–∞—Ç–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏',
                  formula: 'Compression: g_compressed = Quantize(g) √ó 100-600√ó',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 6: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å' },
                
                { id: 6, label: 'Mixture of Experts', group: 'architecture', year: 1991,
                  description: '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–µ—Ç—è–º–∏',
                  formula: 'MoE: y = ‚àëG(x)_i √ó E_i(x)',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 3: –õ–æ–∫–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ' },
                
                { id: 7, label: 'Consensus Protocols', group: 'method', year: 1978,
                  description: '–ü—Ä–æ—Ç–æ–∫–æ–ª—ã –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏—è –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö',
                  formula: 'Consensus: ‚àÄi,j: state_i = state_j',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 7: –í–ª–æ–∂–µ–Ω–∏–µ' },
                
                { id: 8, label: 'Ray Cluster', group: 'tool', year: 2017,
                  description: '–§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π',
                  formula: 'Ray: task_parallel(f, args) ‚Üí Future',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 8: –ü—Ä–æ—Ç–∏–≤–æ–≤–µ—Å' },
                
                { id: 9, label: 'DeepSpeed', group: 'tool', year: 2020,
                  description: '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è',
                  formula: 'DeepSpeed: ZeRO = {Stage1, Stage2, Stage3}',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 9: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ' },
                
                { id: 10, label: 'vLLM', group: 'tool', year: 2023,
                  description: '–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –¥–ª—è LLM',
                  formula: 'vLLM: throughput = 10-20√ó vs standard',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 10: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ' },
                
                // –ú–µ—Ç–æ–¥—ã –æ–±—É—á–µ–Ω–∏—è
                { id: 11, label: 'Federated Averaging', group: 'method', year: 2016,
                  description: '–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏',
                  formula: 'FedAvg: w = (1/K)‚àëw_k',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 11: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è' },
                
                { id: 12, label: 'Differential Privacy', group: 'technique', year: 2006,
                  description: '–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∫ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö',
                  formula: 'DP: Pr[M(D) ‚àà S] ‚â§ e^Œµ √ó Pr[M(D\') ‚àà S]',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 12: –≠–∫–≤–∏–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å' },
                
                { id: 13, label: 'Knowledge Distillation', group: 'technique', year: 2015,
                  description: '–ü–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞–Ω–∏–π –æ—Ç –±–æ–ª—å—à–æ–π –º–æ–¥–µ–ª–∏ –∫ –º–∞–ª–µ–Ω—å–∫–æ–π',
                  formula: 'KD: L = Œ±L_CE + (1-Œ±)L_KL',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 13: –ù–∞–æ–±–æ—Ä–æ—Ç' },
                
                { id: 14, label: 'Model Merging', group: 'method', year: 2022,
                  description: '–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π',
                  formula: 'Merge: Œ∏_merged = Œ±Œ∏_1 + (1-Œ±)Œ∏_2',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 14: –°—Ñ–µ—Ä–æ–∏–¥–∞–ª—å–Ω–æ—Å—Ç—å' },
                
                { id: 15, label: 'Attention Mechanism', group: 'architecture', year: 2017,
                  description: '–ú–µ—Ö–∞–Ω–∏–∑–º –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
                  formula: 'Attention: Œ± = softmax(Q K^T / ‚àöd_k)',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 15: –î–∏–Ω–∞–º–∏—á–Ω–æ—Å—Ç—å' },
                
                // –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                { id: 16, label: 'Cocoon Platform', group: 'application', year: 2024,
                  description: '–î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–æ–µ–≤–æ–≥–æ –ò–ò –Ω–∞ TON',
                  formula: 'Cocoon: Agents √ó TON √ó Telegram',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 16: –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∏–ª–∏ –∏–∑–±—ã—Ç–æ—á–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ' },
                
                { id: 17, label: 'Telegram Bot Swarm', group: 'application', year: 2024,
                  description: '–†–æ–π –±–æ—Ç–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Telegram',
                  formula: 'BotSwarm: request ‚Üí agent_selection ‚Üí response',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 17: –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥—Ä—É–≥–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ' },
                
                { id: 18, label: 'GPU Cluster Optimization', group: 'application', year: 2023,
                  description: '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö GPU –∫–ª–∞—Å—Ç–µ—Ä–æ–≤',
                  formula: 'Cluster: Efficiency = Throughput / Power',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 18: –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è' },
                
                { id: 19, label: 'Real-time Inference', group: 'application', year: 2024,
                  description: '–ù–∏–∑–∫–æ–ª–∞—Ç–µ–Ω—Ç–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π',
                  formula: 'RTI: latency < 100ms, throughput > 1000 req/s',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 19: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ' },
                
                { id: 20, label: 'Multi-modal Agents', group: 'application', year: 2024,
                  description: '–ê–≥–µ–Ω—Ç—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –≤–∏–¥–µ–æ',
                  formula: 'MultiModal: output = f(text, image, video, audio)',
                  triz: '–ü—Ä–∏–Ω—Ü–∏–ø 20: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å –ø–æ–ª–µ–∑–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è' }
            ],
            
            edges: [
                // –≠–≤–æ–ª—é—Ü–∏—è –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ
                { from: 1, to: 2, type: 'evolves_to', label: '—ç–≤–æ–ª—é—Ü–∏—è' },
                { from: 2, to: 3, type: 'evolves_to', label: '—ç–≤–æ–ª—é—Ü–∏—è' },
                { from: 1, to: 4, type: 'enables', label: '–æ—Å–Ω–æ–≤–∞ –¥–ª—è' },
                { from: 3, to: 6, type: 'enables', label: '–æ—Å–Ω–æ–≤–∞ –¥–ª—è' },
                
                // –ú–µ—Ç–æ–¥—ã –∏ —Ç–µ—Ö–Ω–∏–∫–∏
                { from: 4, to: 11, type: 'implements', label: '—Ä–µ–∞–ª–∏–∑—É–µ—Ç' },
                { from: 4, to: 12, type: 'requires', label: '—Ç—Ä–µ–±—É–µ—Ç' },
                { from: 11, to: 5, type: 'optimized_by', label: '–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è' },
                { from: 6, to: 14, type: 'evolves_to', label: '—ç–≤–æ–ª—é—Ü–∏—è' },
                { from: 15, to: 6, type: 'enables', label: '–æ—Å–Ω–æ–≤–∞ –¥–ª—è' },
                
                // –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
                { from: 4, to: 8, type: 'uses', label: '–∏—Å–ø–æ–ª—å–∑—É–µ—Ç' },
                { from: 11, to: 9, type: 'uses', label: '–∏—Å–ø–æ–ª—å–∑—É–µ—Ç' },
                { from: 6, to: 10, type: 'uses', label: '–∏—Å–ø–æ–ª—å–∑—É–µ—Ç' },
                
                // –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                { from: 2, to: 16, type: 'enables', label: '–æ—Å–Ω–æ–≤–∞ –¥–ª—è' },
                { from: 4, to: 16, type: 'enables', label: '–æ—Å–Ω–æ–≤–∞ –¥–ª—è' },
                { from: 16, to: 17, type: 'implements', label: '—Ä–µ–∞–ª–∏–∑—É–µ—Ç' },
                { from: 8, to: 18, type: 'enables', label: '–æ—Å–Ω–æ–≤–∞ –¥–ª—è' },
                { from: 10, to: 19, type: 'enables', label: '–æ—Å–Ω–æ–≤–∞ –¥–ª—è' },
                { from: 15, to: 20, type: 'enables', label: '–æ—Å–Ω–æ–≤–∞ –¥–ª—è' },
                
                // –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è (–∫–∞–∫ —Ä—ë–±—Ä–∞ —Å —Ç–∏–ø–æ–º contradiction)
                { from: 4, to: 5, type: 'contradiction', label: '–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è ‚Üî –¢–æ—á–Ω–æ—Å—Ç—å', weight: 0.8 },
                { from: 6, to: 12, type: 'contradiction', label: '–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Üî –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å', weight: 0.7 },
                { from: 8, to: 12, type: 'contradiction', label: '–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å ‚Üî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', weight: 0.75 }
            ]
        };
        
        // ============ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ============
        const CATEGORIES = {
            foundation: { color: '#64d8ff', label: '–§—É–Ω–¥–∞–º–µ–Ω—Ç' },
            method: { color: '#a0ff6f', label: '–ú–µ—Ç–æ–¥' },
            technique: { color: '#ff6b9d', label: '–¢–µ—Ö–Ω–∏–∫–∞' },
            architecture: { color: '#ffd93d', label: '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞' },
            tool: { color: '#00d4ff', label: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç' },
            application: { color: '#ff6b9d', label: '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ' }
        };
        
        const EDGE_TYPES = {
            evolves_to: { color: '#64d8ff', width: 2, dashes: false },
            enables: { color: '#a0ff6f', width: 2, dashes: false },
            implements: { color: '#ffd93d', width: 2, dashes: false },
            uses: { color: '#00d4ff', width: 2, dashes: false },
            requires: { color: '#ff6b9d', width: 2, dashes: false },
            optimized_by: { color: '#64d8ff', width: 1.5, dashes: true },
            contradiction: { color: '#ff0000', width: 2, dashes: [5, 5] }
        };
        
        // ============ –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–ï–ú ============
        class GraphState {
            constructor() {
                this.nodes = new vis.DataSet(GRAPH_DATA.nodes.map(n => ({
                    ...n,
                    color: CATEGORIES[n.group].color,
                    title: n.description,
                    font: { size: 14, color: '#fff' },
                    shape: 'dot',
                    size: 25
                })));
                
                this.edges = new vis.DataSet(GRAPH_DATA.edges.map(e => ({
                    ...e,
                    color: EDGE_TYPES[e.type].color,
                    width: EDGE_TYPES[e.type].width,
                    dashes: EDGE_TYPES[e.type].dashes,
                    font: { size: 12, color: '#e0e0e0' },
                    smooth: { type: 'continuous' }
                })));
                
                this.network = null;
                this.filters = {
                    categories: new Set(),
                    edgeTypes: new Set(),
                    maxYear: 2025,
                    searchQuery: ''
                };
                
                this.initializeUI();
            }
            
            initializeUI() {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                const categoryFilters = document.getElementById('categoryFilters');
                Object.entries(CATEGORIES).forEach(([key, cat]) => {
                    const label = document.createElement('label');
                    label.className = 'filter-item';
                    label.innerHTML = `
                        <input type="checkbox" data-category="${key}">
                        <label style="margin: 0;">${cat.label}</label>
                    `;
                    categoryFilters.appendChild(label);
                });
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Ç–∏–ø–æ–≤ —Ä—ë–±–µ—Ä
                const edgeFilters = document.getElementById('edgeFilters');
                Object.entries(EDGE_TYPES).forEach(([key, type]) => {
                    const label = document.createElement('label');
                    label.className = 'filter-item';
                    label.innerHTML = `
                        <input type="checkbox" data-edge-type="${key}">
                        <label style="margin: 0;">${key}</label>
                    `;
                    edgeFilters.appendChild(label);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                document.querySelectorAll('[data-category]').forEach(cb => {
                    cb.addEventListener('change', () => this.applyFilters());
                });
                
                document.querySelectorAll('[data-edge-type]').forEach(cb => {
                    cb.addEventListener('change', () => this.applyFilters());
                });
                
                document.getElementById('yearSlider').addEventListener('input', (e) => {
                    this.filters.maxYear = parseInt(e.target.value);
                    document.getElementById('yearDisplay').textContent = e.target.value;
                    this.applyFilters();
                });
                
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.filters.searchQuery = e.target.value.toLowerCase();
                    this.applyFilters();
                });
            }
            
            applyFilters() {
                // –°–æ–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
                const activeCategories = new Set(
                    Array.from(document.querySelectorAll('[data-category]:checked'))
                        .map(cb => cb.dataset.category)
                );
                
                const activeEdgeTypes = new Set(
                    Array.from(document.querySelectorAll('[data-edge-type]:checked'))
                        .map(cb => cb.dataset.edgeType)
                );
                
                // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∫ —É–∑–ª–∞–º
                this.nodes.forEach(node => {
                    let visible = true;
                    
                    if (activeCategories.size > 0 && !activeCategories.has(node.group)) {
                        visible = false;
                    }
                    
                    if (node.year > this.filters.maxYear) {
                        visible = false;
                    }
                    
                    if (this.filters.searchQuery && 
                        !node.label.toLowerCase().includes(this.filters.searchQuery)) {
                        visible = false;
                    }
                    
                    this.nodes.update({ id: node.id, hidden: !visible });
                });
                
                // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∫ —Ä—ë–±—Ä–∞–º
                if (activeEdgeTypes.size > 0) {
                    this.edges.forEach(edge => {
                        const visible = activeEdgeTypes.has(edge.type);
                        this.edges.update({ id: edge.id, hidden: !visible });
                    });
                }
            }
            
            selectNode(nodeId) {
                const node = this.nodes.get(nodeId);
                if (!node) return;
                
                const infoPanel = document.getElementById('infoPanel');
                infoPanel.classList.add('active');
                
                document.getElementById('infoTitle').textContent = node.label;
                document.getElementById('infoCategory').textContent = CATEGORIES[node.group].label;
                document.getElementById('infoYear').textContent = node.year;
                document.getElementById('infoDescription').textContent = node.description;
                
                if (node.formula) {
                    const formulaBox = document.getElementById('infoFormula');
                    formulaBox.textContent = node.formula;
                    formulaBox.style.display = 'block';
                }
                
                if (node.triz) {
                    document.getElementById('infoTRIZ').textContent = node.triz;
                }
                
                // –ù–∞–π—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —É–∑–ª—ã
                const relatedIds = new Set();
                this.edges.forEach(edge => {
                    if (edge.from === nodeId) relatedIds.add(edge.to);
                    if (edge.to === nodeId) relatedIds.add(edge.from);
                });
                
                const relatedHtml = Array.from(relatedIds)
                    .map(id => {
                        const relNode = this.nodes.get(id);
                        return `<div class="tag">${relNode.label}</div>`;
                    })
                    .join('');
                
                document.getElementById('infoRelated').innerHTML = relatedHtml || '<div class="tag">–ù–µ—Ç —Å–≤—è–∑–µ–π</div>';
                
                // –í—ã–¥–µ–ª–∏—Ç—å —É–∑–µ–ª –≤ –≥—Ä–∞—Ñ–µ
                this.network.selectNodes([nodeId]);
                this.network.focus(nodeId, { scale: 1.5, animation: true });
            }
            
            resetView() {
                document.querySelectorAll('[data-category], [data-edge-type]').forEach(cb => {
                    cb.checked = false;
                });
                this.filters.searchQuery = '';
                document.getElementById('searchInput').value = '';
                this.applyFilters();
                this.network.fit();
            }
            
            exportState() {
                const state = {
                    filters: {
                        categories: Array.from(this.filters.categories),
                        edgeTypes: Array.from(this.filters.edgeTypes),
                        maxYear: this.filters.maxYear,
                        searchQuery: this.filters.searchQuery
                    },
                    selectedNode: this.network.getSelectedNodes()[0] || null
                };
                localStorage.setItem('graphState', JSON.stringify(state));
                alert('–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
            }
            
            importState() {
                const state = JSON.parse(localStorage.getItem('graphState'));
                if (!state) return;
                
                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                state.filters.categories.forEach(cat => {
                    const cb = document.querySelector(`[data-category="${cat}"]`);
                    if (cb) cb.checked = true;
                });
                
                state.filters.edgeTypes.forEach(type => {
                    const cb = document.querySelector(`[data-edge-type="${type}"]`);
                    if (cb) cb.checked = true;
                });
                
                document.getElementById('yearSlider').value = state.filters.maxYear;
                document.getElementById('yearDisplay').textContent = state.filters.maxYear;
                document.getElementById('searchInput').value = state.filters.searchQuery;
                
                this.applyFilters();
                
                if (state.selectedNode) {
                    this.selectNode(state.selectedNode);
                }
            }
        }
        
        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
        let graphState;
        
        window.addEventListener('DOMContentLoaded', () => {
            graphState = new GraphState();
            
            const container = document.getElementById('network');
            const options = {
                physics: {
                    enabled: true,
                    stabilization: {
                        iterations: 200
                    },
                    forceAtlas2Based: {
                        gravitationalConstant: -50,
                        centralGravity: 0.01,
                        springLength: 200,
                        springConstant: 0.08
                    },
                    maxVelocity: 50,
                    solver: 'forceAtlas2Based',
                    timestep: 0.35
                },
                interaction: {
                    navigationButtons: true,
                    keyboard: true,
                    zoomView: true,
                    dragView: true
                },
                nodes: {
                    borderWidth: 2,
                    borderWidthSelected: 4
                }
            };
            
            graphState.network = new vis.Network(container, 
                { nodes: graphState.nodes, edges: graphState.edges }, 
                options);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —É–∑–µ–ª
            graphState.network.on('click', (params) => {
                if (params.nodes.length > 0) {
                    graphState.selectNode(params.nodes[0]);
                }
            });
            
            // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                if (e.key === 'Escape') {
                    graphState.resetView();
                }
            });
            
            // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            try {
                graphState.importState();
            } catch (e) {
                console.log('–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è');
            }
        });
        
        // ============ –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø ============
        function toggleLayout() {
            alert('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∞–∫–µ—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ v3.1');
        }
        
        function togglePhysics() {
            graphState.network.physics.enabled = !graphState.network.physics.enabled;
        }
        
        function exportGraph() {
            const data = {
                nodes: graphState.nodes.get(),
                edges: graphState.edges.get()
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'knowledge-graph.json';
            a.click();
        }
        
        function resetView() {
            graphState.resetView();
        }
        
        function saveState() {
            graphState.exportState();
        }
        
        function loadState() {
            graphState.importState();
        }
    </script>
</body>
</html>
